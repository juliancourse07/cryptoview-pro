"""
Motor de backtesting
"""
import numpy as np
import pandas as pd
from typing import Dict
from sklearn.metrics import mean_absolute_error, mean_squared_error

class Backtester:
    """Ejecuta backtesting de modelos"""
    
    def __init__(self):
        self.results = {}
    
    def calculate_metrics(self, actual: np.ndarray, predicted: np.ndarray) -> Dict:
        """Calcula métricas de evaluación"""
        mae = mean_absolute_error(actual, predicted)
        rmse = np.sqrt(mean_squared_error(actual, predicted))
        mape = np.mean(np.abs((actual - predicted) / actual)) * 100
        
        # Precisión de dirección
        actual_direction = np.sign(np.diff(actual))
        pred_direction = np.sign(np.diff(predicted))
        direction_accuracy = np.mean(actual_direction == pred_direction) * 100
        
        return {
            'MAE': mae,
            'RMSE': rmse,
            'MAPE': mape,
            'Direction_Accuracy': direction_accuracy
        }